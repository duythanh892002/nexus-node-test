name: nexus testnet node

on:
  workflow_dispatch:          # Cho phÃ©p cháº¡y thá»§ cÃ´ng
  schedule:
    - cron: "0 */6 * * *"     # Tá»± cháº¡y má»—i 6 tiáº¿ng

jobs:
  run-node:
    runs-on: ubuntu-latest
    timeout-minutes: 30       # Giá»›i háº¡n cháº¡y tá»‘i Ä‘a 30 phÃºt

    steps:
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ‹ Setup Docker
        uses: docker/setup-buildx-action@v3

      - name: ğŸš€ Run Nexus Testnet Node
        env:
          NODE_ID: 25642744
        run: |
          echo "============================================"
          echo "ğŸš€ Starting Nexus Testnet Node"
          echo "ğŸ”¹ Node ID: $NODE_ID"
          echo "ğŸ”¹ Network: testnet"
          echo "============================================"

          # KÃ©o image má»›i nháº¥t
          docker pull nexuschain/nexus-node:latest || echo "âš ï¸ Failed to pull image"

          # Dá»«ng vÃ  xÃ³a container cÅ© (náº¿u cÃ³)
          docker ps -a | grep nexus-node && docker rm -f nexus-node || echo "No previous container"

          # Cháº¡y node
          docker run -d --name nexus-node \
            -e NODE_ID=$NODE_ID \
            -p 8545:8545 \
            -p 30303:30303 \
            nexuschain/nexus-node:latest --network testnet || echo "âŒ Failed to start container"

          echo "ğŸ•“ Waiting for node to initialize..."
          sleep 25

          echo "ğŸ“œ Checking logs..."
          docker logs nexus-node || echo "âš ï¸ No logs found yet"

          # Kiá»ƒm tra node cÃ³ Ä‘ang cháº¡y khÃ´ng
          if [ "$(docker inspect -f '{{.State.Running}}' nexus-node)" != "true" ]; then
            echo "âŒ Node seems to have stopped. Restarting..."
            docker restart nexus-node
            sleep 20
            docker logs nexus-node || echo "âš ï¸ No logs found after restart"
          else
            echo "âœ… Node is running successfully!"
          fi

          echo "============================================"
          echo "âœ… Nexus Node job completed"
          echo "============================================"
